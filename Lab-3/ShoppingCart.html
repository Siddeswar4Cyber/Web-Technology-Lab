<!DOCTYPE html>
<html>
    <head>
        <title>Shopping Cart</title>
        <style>
            body {
                font-family: Arial;
                width:500px;
                margin:auto;
            }

            .cart-item {
                border-bottom:1px soild #ccc;
                padding: 10px;
            }

            button {
                margin: 5px;
            }
        </style>
    </head>
    <body>
        <h2>Shopping Cart</h2>
        
        <div id="cart"></div>

        <input type="text" id="coupon" placeholder="Enter Coupon Code">
        <button onclick="applyCoupon()">Apply Coupon</button>

        <h3>Total: ₹<span id="total">0</span></h3>

        <script>
            let products = [
                {name:"Laptop", category:"electronics",img:"laptop.webp",price: 50000, quantity: 1},
                {name:"Mobile", category:"electronics",img:"mobile.webp",price: 15000, quantity: 1},
                {name: "Book",category:"books",img:"book.jpg",price:500,quantity:2}
            ];
            let couponDiscount = 0;
            function renderCart(){
                let cartDiv = document.getElementById("cart");
                cartDiv.innerHTML = ``;
                let total = 0;

                products.forEach((product, index) => {
                    let price = calculateDiscount(product);
                    console.log(product.name);
                    total += price;

                    cartDiv.innerHTML += `
                        <div class="cart-item">
                            <img src="${product.img}" alt="${product.name}" width="100">
                            <br>
                            <b>${product.name}</b>
                            (${product.category})
                            <br>
                            Price = ${product.price} ×
                            <input style="width: 40px;" type = "number" value="${product.quantity}" min="1" onchange="updateQuantity(${index},this.value)">
                            <button onclick="removeItem(${index})">Remove</button>
                            <br>
                            Subtotal : ₹${price.toFixed(2)}
                        </div>
                    `;

                });
                total -=couponDiscount;
                document.getElementById("total").innerText = total.toFixed(2);
            }

            function updateQuantity(index, quantity){
                products[index].quantity = parseInt(quantity);
                if(quantity < 1){
                    removeItem(index);
                }

                
                renderCart();
            }
            
            function removeItem(index){
                products.splice(index, 1);
                renderCart();
            }

            function calculateDiscount(product) {
                let subtotal = product.price * product.quantity;
                
                if(product.quantity >= 5) {
                    subtotal *= 0.9; // 10% discount for 5 or more items
                }

                if(product.category === "electronics" && subtotal >= 200000) {
                    subtotal *= 0.95; // Additional 5% discount for electronics over ₹20,000
                }

                if(product.category === "books" && product.quantity >= 3) {
                    subtotal -= 100; // Flat ₹100 discount for 3 or more books
                }
                return subtotal;
            }

            function applyCoupon(){
                let code = document.getElementById("coupon").value.trim();
                if(code === "BLACKFRIDAY" && products.reduce((acc, product) => acc + (product.price * product.quantity), 0) >= 100000){
                    couponDiscount = 5000;
                }
                else if(code ==="SAVE10"){
                    couponDiscount = 0.1 * products.reduce((acc, product) => acc + (product.price * product.quantity), 0);
                } else {
                    alert("Invalid Coupon Code");
                }
                renderCart();
            }
            renderCart();
        </script>
    </body>
</html>